<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"	
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
	layout:decorate="~{/layout/membership_layout2}">
<head>
<title>멤버십 결제 - 플레이보이스 | Playvoice</title>

<link rel="stylesheet" th:href="@{/css/app/membership.css}">

<script th:inline="javascript">
$(document).ready(function(){
	// [menu active]------------------------------------------------------------
	$("#menuSection .membershipInfo").addClass("menu-active");
	
	// [숫자만 입력시키기 (전화번호, 캐쉬 입력란)]-------------------------------------------
	$(".onlyInputNumber").on("change keyup keydown", function(){
		var type = $(this).val().replace(/[^0-9]/g,'');
		$(this).val(type);
	});
	
	$("html").addClass("modalOpen");
	// [주소 검색창 닫기]------------------------------------------------------------
	$(".closeZipCodeModal").click(function(){
		$("#searchZipCodeSection").hide();
		$("html").removeClass("modalOpen");
	});
	// [할인 금액 선택시 선택한 폼 active 시키기]-------------------------------------------
	$(".discount-cover").click(function(){
		$(".discount-cover").removeClass("active");
		$(this).addClass("active");
		var discountType = $(this).find(".discountType");
		discountType.prop("checked", true);
		var totalPrice = $(".totalPrice").text();
		if(discountType.val() == 'cash') {
			$(".couponForm").prop("disabled", true);
			$(".cashForm").prop("readonly", false);
			$(".cashForm").focus();
			
			var useCash = $(".cashForm").val();
			var type = 'A';
			applyDiscountPrice(useCash, type); // 입력된 캐쉬 값이 있으면 결제 정보에 적용
		} else if(discountType.val() == 'coupon') {
			$(".couponForm").prop("disabled", false);
			$(".cashForm").prop("readonly", true);
			
			var useCash = $(".couponForm").val();
			var type = $(this).find("option:selected").attr("data-discountType");
			applyDiscountPrice(useCash, type);
		}
	});
	
	// [캐쉬 모두 사용 선택 시 캐쉬 입력란에 숫자 입력]------------------------------------------
	$(".allUse").click(function(){
		var myCash = $(".myCash").val();
		if($(this).is(":checked") == true) {
			$(".cashForm").val(myCash);
		} else {
			$(".cashForm").val("0");
		}
	});
	// [캐쉬 입력란에 숫자 입력시 결제 정보에 반영]--------------------------------------------
	$(".cashForm").on("change", function(){
		var myCash = $(".myCash").val(); // 보유 캐쉬
		var inputCash = $(this).val(); // 입력한 캐쉬
		var type = 'A';
		inputCash = parseInt(inputCash.replace(/(^0+)/, ""));
		var useCash = 0;
		if(inputCash > myCash) {
			useCash = myCash;
		} else if(inputCash == "") {
			useCash = 0;
		} else {
			useCash = inputCash;
		}
		$(this).val(useCash);
		
		// 입력된 캐쉬 값을 결제 정보에 적용
		applyDiscountPrice(useCash, type);
	});

	// [쿠폰 선택시 결제 정보에 반영]-----------------------------------------------------
	$(".couponForm").on("change", function(){
		var myCoupon = $(".couponForm").val(); // 보유 캐시
		var type = $(this).find("option:selected").attr("data-discountType");
		// 입력된 캐시 값을 결제 정보에 적용
		applyDiscountPrice(myCoupon, type);
	});
	
	// [결제 정보에 현재 날짜 데이터 표시하기]-----------------------------------------------
	var todayDate = new Date();
	var monthNames = ["January", "February", "March", "April", "May", "June",
			"July", "August", "September", "October", "November", "December"];
	var year = todayDate.getFullYear();
	var month = todayDate.getMonth() + 1;
	var date = "";
	if(todayDate.getDate() < 10) {
		date = "0" + todayDate.getDate();
	} else {
		date = todayDate.getDate();
	}
	$(".todayDate").html(year + "-" + month + "-" + date);
	$(".ticket-date-border .year").html(year);
	$(".ticket-date-border .month").html(monthNames[todayDate.getMonth()]);
	$(".ticket-date-border .date").html(date);
	
	
	// [결제 수단 선택 시 가이드 메세지 보여주기]---------------------------------------------
	$(".paymentWay").click(function(){
		var paymentWay = $(this).val();
		$(".way-info-guide").hide();
		if(paymentWay == 'card') {
			$("#payCardGuide").show();
		} else if (paymentWay == 'vbank') {
			$("#payVbankGuide").show();
			$(".depositName").focus();
		}
	});
	
	// [결제 하기]-----------------------------------------------------------------
	$("#paymentBtn").click(function(){
		location.href="/payment/membership/result";	
	});
	
});

/**
 * 입력된 할인 가격을 결제 정보에 적용
 */
function applyDiscountPrice(discountAmount, type) {
	var totalPrice = $("#totalPrice").val();
	var inputTotalPrice = totalPrice - discountAmount;
	if(type == 'R') {
		inputTotalPrice = totalPrice*(1-discountAmount);
		discountAmount = totalPrice*discountAmount;
	}
	inputTotalPrice = inputTotalPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	discountAmount = parseInt(discountAmount).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	$(".applyDiscount").text(discountAmount);
	$(".inputTotalPrice").text(inputTotalPrice);
}
 
</script>

</head>

<section layout:fragment="content">

<div id="menuSection" th:insert="~{/membership/incl/membership_menu2::menu}"></div>

<div class="introduction-section mt-4">
	<h3>Join the Gold Membership</h3>
	<div class="sub">
		Please fill the text in the field.
	</div>
</div>

<div id="joinMembershipSection" class="join-membership-section">
<form>
<div class="row no-gutters">

<!-- ----------------------------[1. 정보 입력]-------------------------------- -->
<div id="addInformationDiv" class="personal-payment-info-section col-md pr-md-3">
	
	
	<!-- [1.1 개인정보 입력] -->
	<div class="member-info-section personal-payment-info-cover none-info">
		<h5>정보 입력 
			<a class="loginRequired" th:href="@{/mypage/member/edit}" 
				target="_blank" title="개인 정보 수정"><i class="fa fa-edit"></i></a>
		</h5>
		<div class="form-group row no-gutters">
			<label class="col-lg-2 col-auto">이름</label>
			<div class="col-lg-5 col-12">
				<input type="text" class="form-control"/>
			</div>
		</div>
		<div class="form-group row no-gutters">
			<label class="col-lg-2 col-auto">전화번호</label>
			<div class="col-lg-10 col-12 row no-gutters">
				<div class="col-xl-2 col-lg-3 col">
					<select id="phone1" class="buyerTel confirm-edit form-control"
						th:with="phone1Arr=${#strings.arraySplit('010,011,012,015,016,017,018,019',',')}">
						<option th:each="phone1:${phone1Arr}" th:text="${phone1}" 
							th:value="${phone1}"></option>
					</select>
				</div>
				<div class="col-auto align-self-center px-2"> - </div>
				<div class="col-xl-2 col-lg-3 col">
					<input type="tel" class="confirm-edit form-control onlyInputNumber" 
						maxlength="4"/>
				</div>
				<div class="col-auto align-self-center px-2"> - </div>
				<div class="col-xl-2 col-lg-3 col">
					<input type="tel" class="confirm-edit form-control onlyInputNumber" 
						maxlength="4"/>
				</div>
			</div>
		</div>
		<div class="form-group row no-gutters">
			<label class="col-lg-2 col-auto">주소</label>
			<div class="col-lg-10 col-12">
				<div class="row no-gutters pb-2">
					<div class="col-lg-6 col">
						<input type="text" class="addAdressForm confirm-edit form-control" placeholder="우편 번호"/>
					</div>
					<div class="col-lg col-auto pl-2 control-button">
						<button id="searchPostNum" class="btn btn-sm btn-search-post" type="button">
							우편번호 검색
						</button>
					</div>
				</div>
				<div class="pb-2">
					<input type="text" class="addAdressForm confirm-edit form-control" placeholder="주소"/>
				</div>
				<div class="pb-1">
					<input type="text" class="confirm-edit form-control" placeholder="상세 주소"/>
				</div>
			</div>
		</div>
		<div class="form-guide">
			* 개인정보 및 연락처의 수정은 
			<a class="loginRequired" 
				th:href="@{/mypage/member/edit}" target="_blank">회원 정보 수정</a> 
			페이지에서 변경해 주세요.
		</div>
	</div>
	
	
	<!-- [1.3 할인 정보 입력] -->
	<div class="discount-section personal-payment-info-cover">
		<h5>할인 금액</h5>
		
		<div class="discount-cover-row row no-gutters">
			<!-- 포인트 할인 -->
			<div class="col-md-6 px-2 pb-2"><div class="discount-cover">
				<div>
					<label class="option-label">
						<input type="radio" name="discountType" class="discountType option-input radio" 
							value="cash"> 캐시
					</label>
				</div>
				<div class="row no-gutters">
					<div class="choice-title col-lg-4 col-md-auto col-4 align-self-center">보유 캐시</div>
					<div class="choice-detail col pl-2 text-lg-left text-md-right text-left align-self-center">
						<span th:text="${#numbers.formatInteger(0, 1, 'COMMA')}"></span>
						<input type="hidden" value="0" class="myCash"/>
					</div>
					<div class="choice-detail col-lg-auto col-md-12 col-auto text-right align-self-center">
						<label style="margin: 0;">
						<input type="checkbox" class="allUse option-input checkbox"> 모두 사용
						</label>
					</div><div class="w-100 mb-2"></div>
					<div class="choice-title col-lg-4 col-md-auto col-4 align-self-center">사용할 캐시</div>
					<div class="col-lg-8 col-md-12 col pl-md-0 pl-2 align-self-center">
						<input type="text" class="cashForm form-control onlyInputNumber" 
							value="0" readonly="readonly"/>
					</div>
				</div>
			</div></div>
			
			<!-- 쿠폰 할인 -->
			<div class="col-md-6 px-2 pb-2"><div class="discount-cover">
				<div>
					<label class="option-label">
						<input type="radio" name="discountType" class="discountType option-input radio" 
							value="coupon"> 쿠폰
					</label>
				</div>
				<div class="row no-gutters">
					<div class="choice-title col-lg-4 col-auto align-self-center">보유 쿠폰</div>
					<div class="choice-detail col pl-2 text-lg-left text-right 
						align-self-center"><span th:text="${myCouponList.size()}">1</span> 개</div>
					<div class="w-100 mb-2"></div>
					<div class="col-12 align-self-end">
						<select class="couponForm form-control" disabled="disabled">
							<option value="0">== 쿠폰 선택 안 함 ==</option>
							<th:block th:each="coupon, iter : ${myCouponList}">
								<option th:if="${#strings.contains('A',(discountType[iter.index]))}" 
									th:value="${dicountAmount[iter.index]}" 
									th:data-discountType="${discountType[iter.index]}"
									th:text="${coupon} + ' (' + 
									${#numbers.formatInteger(dicountAmount[iter.index], 1, 'COMMA')} + '원)'"></option>
								<option th:if="${#strings.contains('R',(discountType[iter.index]))}" 
									th:value="${dicountAmount[iter.index]}" 
									th:data-discountType="${discountType[iter.index]}"
									th:text="${coupon} + ' (' + 
									${#numbers.formatInteger(dicountAmount[iter.index]*100, 1, 'COMMA')} + '%)'"></option>
							</th:block>
						</select>
					</div>
				</div>
			</div></div>
		</div>
	</div>
	
	<!-- [1.4 결제 수단 선택] -->
	<div class="payment-section personal-payment-info-cover">
		<h5>결제 수단</h5>
		<div class="row no-gutters">
			<div class="col-md-6 px-2 mb-2">
				<label class="option-label">
					<input type="radio" name="paymentWay" checked="checked" 
						value="card" class="paymentWay option-input radio"> 신용/체크카드
				</label>
			</div>
			<div class="col-md-6 px-2 mb-2">
				<label class="option-label">
					<input type="radio" name="paymentWay" value="vbank" 
						class="paymentWay option-input radio"> 무통장 입금
				</label>
			</div>
			<div class="col-md-6 px-2 mb-2">
				<label class="option-label">
					<input type="radio" name="paymentWay" value="trans" 
						class="paymentWay option-input radio"> 실시간 계좌 이체
				</label>
			</div>
			<!-- <div class="col-md-6 px-2 mb-2">
				<label class="option-label">
					<input type="radio" name="paymentWay" value="phone" 
						class="paymentWay option-input radio"> 휴대폰 소액 결제
				</label>
			</div> -->
		</div>
		
		<!-- 결제 수단 가이드/ 추가 폼 -->
		<div id="payCardGuide" class="way-info-guide">
			- 결제 개월 수에 따라 무이자 할부 지원<br>
			- 체크 카드, 법인 카드는 할부 결제 불가
		</div>
	</div>
</div><!-- end of addInformationDiv -->




<!-- ----------------------------[2. 결제 정보]-------------------------------- -->
<div id="paymentInfoDiv" class="payment-information-section col-md-auto">
	<div class="gold-ticket-bg gold member-P">
		<!-- ticket header -->
		<div class="ticket-header ticket-style row no-gutters">
			<div class="col">
				<div class="small-title">playvoice</div>
				<div class="title">membership</div>
			</div>
			<div class="ticket-header-logo col-auto">
				<img src="/images/logo/logo_trans_seonbi.png">
			</div>
		</div>
		<!-- ticket body -->
		<div class="ticket-body ticket-style">
			<div class="ticket-divine"></div>
			<div class="style-line">
				<div class="style-line-detail"></div>
				<div class="logo-section"><div align="center">
					<div class="member-personacon-lg">
						<img src="/images/app/member/profile_paper.png" 
							class="personacon-profile"
							style="background: url('/images/app/member/profile_ex7.jpg') no-repeat;
							background-position: center; background-size: cover;">
						<img src="/images/app/member/profile_paper.png" 
							class="personacon-frame ticket-frame">
					</div>
				</div></div>
			</div>
			<div class="ticket-detail-line mb-3"><div class="ticket-detail">
				<!-- [2.1 서비스 정보] -->
				<div class="service-info-cover">
					<div class="detail-title">상품명</div>
					<div class="detail-info service">
						<b>골드 멤버십</b> 1분기 가입
					</div>
				</div>
				<div class="service-info-cover">
					<div class="detail-title">금액</div>
					<div class="detail-info">
						<!-- 서비스 금액 -->
						<span class="big" 
							th:text="${#numbers.formatInteger(114000, 1, 'COMMA')}"></span>
						<span class="small">원</span>
					</div>
				</div>
				<div class="service-info-cover">
					<div class="detail-title">기간</div>
					<div class="detail-info">
						<span class="todayDate big">오늘 날짜</span> ~
						<span class="small">서비스 정지 당월 말까지</span>
					</div>
				</div>
				<!-- [2.2 할인 금액] -->
				<div class="service-info-cover">
					<div class="detail-title">할인 금액</div>
					<div class="detail-info">
						<span class="applyDiscount big">0</span>
						<span class="small">원</span>
					</div>
				</div>
				<div class="ticket-welcome-comment">
					<div>Come play with us!!</div>
					<div class="small">
						You can build your ideas and contents libraries here.
					</div>					
				</div>
			</div></div>
			<div class="ticket-divine2"></div>
		</div>
		<!-- ticket footer -->
		<div class="ticket-footer ticket-style">
			<div class="payment-cover row no-gutters">
				<div class="col-12 px-2">
					<div class="sub-title">총 결제 금액</div>
				</div>
				<div class="col-auto align-self-end">
					<!-- [2.3 결제 금액] -->
					<div class="detail">
						<input id="totalPrice" type="hidden" value="114000"/>
						<i class="fa fa-won-sign mr-1"></i><span 
							th:text="${#numbers.formatInteger(114000, 3, 'COMMA')}"
						 	class="inputTotalPrice">114,000</span>
					</div>
					<div class="code-section">
						<i class="fa fa-barcode"></i><i class="fa fa-barcode"></i><i class="fa fa-barcode"></i>
					</div>
				</div><div class="col"></div>
				<div class="col-auto">
					<div class="ticket-date-border">
						<div class="month">월</div>
						<div class="date">날짜</div>
						<div class="year">연도</div>
					</div>
				</div>
				<!-- <div class="total-payment-comment px-2 col-12">
					* 해당 상품은 정기권이므로<br>
					매달 해당 서비스의 금액이 결제됩니다.
				</div> -->
			</div>
		</div>
	</div>
</div><!-- end of paymentInfoDiv -->


<!-- [결제 하기] -->
<div class="join-membership-button-section col-12 row no-gutters"><div class="col-md"></div>
	<div class="col-md-auto">
		<div class="join-membership-guide-msg"><label>
			<input type="checkbox" class="option-input checkbox">
			주문 내역 및 결제 정보를 확인하였으며,
			개인 정보 수집 및 <a target="_blank" th:href="@{/terms/policy}">이용 약관</a>에 동의합니다.
		</label></div>
		<button id="paymentBtn" class="btn btn-main2 w-100" type="button">결제하기</button>
	</div>
<div class="col-md"></div></div>

</div>
</form>

<!-- ------------------------------[유의 사항]--------------------------------- -->
<div class="payment-attend-section mt-4">
	<div class="payment-attend-cover">
		<div class="title">[안내사항]</div>
		<div><ul>
			<li>모든 회원권 요금에는 부가세가 포함되어 있습니다.</li>
			<li>평생회원권은 5년 갱신 상품으로, 5년마다 구매 내역 페이지에서 
				갱신 버튼을 클릭해야 하며, 갱신하지 않을 시 즉시 회원권이 해지됩니다.</li>
			<!-- <li>정기권 요금은 첫 3달 동안 13,000원이며 4달째부터는 매달 9,000원이 결제됩니다.<br>
				정기권 요금은 매 해 1,000원씩 할인되며 정기권 이용 5년째 되는 해부터 매달 5,000원이 결제됩니다.</li>
			<li>정기권을 해지 시, 다시 정기권을 결제하면 처음의 요금인 13,000원부터 과금됩니다.</li> -->
		</ul></div>
	</div>
	
	<div class="payment-attend-cover">
		<div class="title">[유의사항]</div>
		<div><ul>
			<li><a th:href="@{/payment/membership/fail}">
				멤버십 기간 동안 플레이 포인트 제약 없이 서비스를 자유롭게 이용 가능하며 
				골드 또는 플래티넘 멤버십의 경우 활동에 따라 골드 포인트를 획득하게 됩니다.<br>
				단, 활동 시작 후 획득한 골드 포인트는 멤버십 만료일 자정을 기준으로 사용할 수 없게 됩니다.</a></li>
			<li>결제 후 서비스를 한 번도 이용하지 않은 경우 결제일로부터 3일 이내에 결제한 금액의 전액 취소가 가능합니다.<br>
				결제 후 서비스를 이용한 경우 결제일로부터 7일 이내에 결제한 금액에 대해 부분 환불이 가능합니다.<br>
				단, 골드 멤버십 무료 체험을 이용한 경우, 부분 환불은 불가합니다.</li>
			<li>플레이보이스는 서비스 <a th:href="@{/terms/policy}" 
				target="_blank">이용 약관</a>에 따라 환불 절차를 진행하고 있습니다.
				<a th:href="@{/terms/policy}" 
					target="_blank">(이용 약관 제21~23조 참고)</a></li>
			<li>결제 및 환불에 대해 궁금한 사항이 있다면 
				<a th:href="@{/membership/guide}" target="_blank">멤버십 FAQ</a>에서
				내용을 확인해 주시기 바랍니다.</li>
		</ul></div>
	</div>
	
	<div class="payment-attend-cover">
		<div class="title">[현금 영수증 안내]</div>
		<div><ul>
			<li>현금영수증은 1원 이상의 현금성거래(무통장입금, 실시간계좌이체)에 대해 발행이 됩니다.</li>
			<li>현금영수증 발행 금액에는 캐쉬, 쿠폰 사용액은 포함되지 않습니다.</li>
			<li>발행신청 기간제한 현금영수증은 입금확인일로 부터 48시간안에 발행을 해야 합니다.</li>
			<li>현금영수증 발행 취소의 경우는 시간 제한이 없습니다. (국세청의 정책에 따라 변경 될 수 있습니다.)</li>
		</ul></div>
	</div>
</div>

</div><!-- end of joinMembershipSection -->


<!-- ---------------------------[우편번호 찾기 모달]------------------------------ -->
<div id="searchZipCodeSection" class="playvoice-inform-modal-section search-zip">
	<div class="closeZipCodeModal inform-modal-back"></div>
	<div class="inform-modal-content">
		<div class="inform-modal-header">
			<i class="closeZipCodeModal fa fa-times"></i>
			<h5 class="kor">주소 검색 <i class="fa fa-search"></i></h5>
		</div>
		<div id="searchZipCodeDiv" class="inform-modal-body">
			<img src="/images/app/search_zip.jpg" width="100%">
		</div>
		<div class="closeZipCodeModal inform-modal-footer d-md-none">
			close
		</div>
	</div>
</div>


</section>