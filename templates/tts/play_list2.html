<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"	
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
	layout:decorate="~{/layout/playvoice_tts_layout2}">
<head>
<title>나의 앨범 (Playvoice TTS) - 플레이보이스 | Playvoice</title>

<!-- search console & sns meta tags -->
<th:block th:insert="~{/incl/meta_fragment2::meta}"
	th:with="metaTitle = '나의 앨범 (Playvoice TTS) - 플레이보이스 | Playvoice', 
	metaDescription = '플레이보이스 TTS는 영어 전문 TTS MP3 파일 변환 서비스입니다. 플레이보이스에는
	수십명의 다양한 성우들의 목소리가 있으며, 자신이 원하는 문장들을 고품질 음성 파일로 쉽고 간편하게 만들 수 있습니다.', 
	metaImage = '/images/common/characters/dictationbook.jpg',
	metaKeyword = 'TTS, MP3, 영어 듣기, 받아쓰기, 딕테이션, 스피킹 '"></th:block>
	
<link rel="stylesheet" th:href="@{/css/app/playvoice_tts.css}">

<script th:inline="javascript">
$(document).ready(function(){

	// [앨범 수정 드롭다운 열기 (헤더 버튼)]------------------------------------------------
	$("#editAlbumInfoBtn").click(function(){
		var menu = $("#editAlbumInfoMenu");
		if(menu.is(":visible")) {
			menu.hide();
		} else {
			menu.fadeIn(200);
		}
	});
	$(".closeAlbumInfoMenu").click(function(){
		$("#editAlbumInfoMenu").hide();
	});
	
	// [플레이 컨텐츠 화면 메뉴 이동]-----------------------------------------------------
	$(".moveAlbumDiv").click(function(){
		var target = $(this).attr("data-target");
		$(".moveAlbumDiv").removeClass("active");
		$(this).addClass("active");
		$(".my-album-content-div").hide();
		$("#myAlbum" + target + "Div").show();
	});
	
	// [앨범 미리 보기 모달 열기]--------------------------------------------------------
	$(".openAlbumModal").click(function(){
		// 앨범 정보
		var albumId = $(this).find(".albumId").val();
		var title = $(this).find(".album-title-section").text();
		var imagePath = $(this).find(".imagePath").val();
		var description = $(this).find(".description").val();
		var regDate = $(this).find(".regDate").val();
		var $cloudVoiceList = $(this).find(".cloudVoiceList").val();
		
		// 모달에 앨범 정보를 넣을 위치
		var viewAlbumModal = $("#viewAlbumModal");
		var albumIdForm = viewAlbumModal.find(".albumId");
		var titleDiv = viewAlbumModal.find(".folder-title");
		var imagePathDiv = viewAlbumModal.find(".folder-image");
		var descriptionDiv = viewAlbumModal.find(".folder-intro-section");
		var regDateDiv = viewAlbumModal.find(".folder-date");
		var cloudVoiceForm = viewAlbumModal.find(".cloudVoiceList");
		
		albumIdForm.val(albumId);
		titleDiv.text(title);
		if(imagePath != null && imagePath.length > 0) {
			imagePathDiv.css("background-image", "url(" + imagePath + ")");
			viewAlbumModal.find(".image-path").val(imagePath);
		}
		if(description != null && description.length > 0) {
			descriptionDiv.removeClass("empty").html(description);
			viewAlbumModal.find(".description").val(description);
		} else {
			descriptionDiv.addClass("empty").html("");
		}
		regDateDiv.text(regDate);
		cloudVoiceForm.val($cloudVoiceList);
		viewAlbumModal.find(".file-size .num").text($cloudVoiceList.length);
		
		$("html").addClass("modalOpen");
		viewAlbumModal.show();
	});
	// [앨범 미리보기 모달 닫기]--------------------------------------------------------
	$(".closeAlbumModal").click(function(){
		$("html").removeClass("modalOpen");
		$("#viewAlbumModal").hide();
	});
	
	// [플레이 횟수 셀렉트 열기]--------------------------------------------------------
	$("#setPlayCountBtn").click(function(){
		$("#playCountOption").toggle();
	});
	$(".closeCountOption").click(function(){
		$("#playCountOption").hide();
	});
	
	// [플레이 횟수 선택]-------------------------------------------------------------
	$("#playCountOption .option").click(function(){
		var repeatCount = $(this).attr("data-count");
		var countView = $("#setPlayCountBtn");
		$("#playCountOption .option").removeClass("selected");
		$(this).addClass("selected");
		
		countView.text(repeatCount);
		$("#playCountOption").hide();
		
		showControlMsg(repeatCount + "회 반복 재생");
	});
	

	
	// [앨범 자켓 사진 수정 모달 열기]-----------------------------------------------------
	$("#viewAlbumModal .folder-image").click(function(){
		var imagePath = $(this).find(".image-path").val();
		var editAlbumId = $("#viewAlbumModal").find(".albumId").val();
		
		var editImageModal = $("#editAlbumImageModal");
		var imageFileLabel = editImageModal.find(".image-file-cover");
		
		if(imagePath != null && imagePath.length > 0) {
			imageFileLabel.css("background-image", "url(" + imagePath + ")");
			editImageModal.find("#imagePath").val(imagePath);
		} else {
			imageFileLabel.css("background-image", "none");
			editImageModal.find("#imagePath").val("");
		}
		$("#editAlbumImageModal").find(".editAlbumId").val(editAlbumId);
		
		$("#viewAlbumModal").css("opacity", "0");
		$("#editAlbumImageModal").show();
	});
	// [앨범 자켓 이미지 수정 모달 닫기]---------------------------------------------------
	$(".closeEditAlbumImageModal").click(function(){
		$("#viewAlbumModal").css("opacity", "1");
		$("#editAlbumImageModal").hide();
	});
	// [앨범 자켓 이미지 수정하기]-------------------------------------------------------
	$("#editAlbumImageBtn").click(function(){
		var imagePath = $("#editAlbumImageModal").find("#imagePath").val();
		var AlbumId = $("#editAlbumImageModal").find(".editAlbumId").val();
		
		if(imagePath == null || imagePath.length < 1) {
			alert("이미지를 선택해 주세요.");
			return;
		} else {
			
		}
	});
	
	
	
	// [앨범 설명 수정 모달 열기]--------------------------------------------------------
	$("#viewAlbumModal .folder-intro-section").click(function(){
		var description = $("#viewAlbumModal").find(".description").val();
		var editAlbumId = $("#viewAlbumModal").find(".albumId").val();
		
		if(description != null && description.length > 0) {
			$("#albumDescriptionFormDiv").find(".albumDescription").val(description);
		} else {
			$("#albumDescriptionFormDiv").find(".albumDescription").val("");
		}
		$("#editAlbumDescriptionSection").find(".editAlbumId").val(editAlbumId);
		
		$("#viewAlbumModal").css("opacity", "0");
		$("#editAlbumDescriptionSection").show();
		location.hash = "#editDescription";
	});
	// [앨범 설명 수정 모달 닫기]--------------------------------------------------------
	$(window).on("hashchange", function(){
		if (location.hash != "#editDescription") {  
			$("#viewAlbumModal").css("opacity", "1");
			$("#editAlbumDescriptionSection").hide();
		}
	});
	// [앨범 설명 수정하기]-----------------------------------------------------------
	$("#editAlbumDescriptionBtn").click(function(){
		var description = $("#editAlbumDescriptionSection").find(".albumDescription").val();
		var AlbumId = $("#editAlbumDescriptionSection").find(".editAlbumId").val();

		if(description == null || description.length < 1) {
			alert("앨범 설명을 작성해 주세요.");
			return;
		} else if (description.length > 255) {
			alert("앨범 설명을 255자 이내로 작성해 주세요.");
		} else {
			
		}
	});
	
	// [플레이 할 음성 파일 선택]--------------------------------------------------------
	$(".list-player-cover").click(function(){
		$(".list-player-cover").removeClass("active open");
		$(this).addClass("active open");
	});
	
	// [처음부터 다시 재생]-----------------------------------------------------------
	$("#replayBtn").click(function(){
		if($(this).is(".active")) {
			$(this).removeClass("active");
			showControlMsg("앨범 반복 재생 취소");
		} else {
			$(this).addClass("active");
			showControlMsg("앨범 전체 반복 재생");
		}
	});
	
	// [플레이 리스트에서 예문 클릭 시 예문 전체 보기]------------------------------------------
	$("#myAlbumPlayListDiv .eng-text").click(function(){
		var parentDiv = $(this).closest(".list-sentences-cover");
		if(parentDiv.is(".active")) {
			parentDiv.removeClass("active");
		} else {
			parentDiv.addClass("active");
		}
	});
	
	// 순서 변경 모드: header, 플레이어 컨트롤러 숨기기,
	// #myAlbumContentSection에 orderMode 클래스 추가
	// $("header, .my-album-audio-control-section").hide();
	
	var longtouchTimer;
	$(document)
	// [플레이 리스트 : 삭제 모드 활성화]--------------------------------------------------
	.on('touchstart','#myAlbumPlayListDiv .list-player-sentence div:not(.move-button-section)', function(e){
		if($(this).closest('.deleteMode,.orderMode').length == 0){
			e.stopPropagation();
			var $checkbox = $(this).closest('.list-player-sentence').find(':checkbox');
			longtouchTimer = setTimeout(function(){
				$("header, .my-album-audio-control-section").hide();
				$("#myAlbumContentSection").addClass("deleteMode");
				$checkbox.prop('checked', !$checkbox.prop('checked'))
						 .trigger('change');
			}, 300);
		}
	})
	// [플레이 리스트 : 순서 변경 모드 활성화]-----------------------------------------------
	.on('touchstart','#myAlbumPlayListDiv .move-button-section', function(e){
		if($(this).closest('.deleteMode,.orderMode').length == 0){
			e.stopPropagation();
			longtouchTimer = setTimeout(function(){
				$("header, .my-album-audio-control-section").hide();
				$("#myAlbumContentSection").addClass("orderMode");
				$('html,body').addClass("scrollBlock");
			}, 300);
		}
	})
	// [롱터치 취소]----------------------------------------------------------------
	.on('touchmove touchend', '#myAlbumPlayListDiv .list-player-sentence div', function(e){
		clearTimeout(longtouchTimer);
	});
	// [기기의 기본 우클릭 메뉴를 막는다]---------------------------------------------------
	$('#myAlbumPlayListDiv .list-player-sentence').on('contextmenu', function(e){
		e.preventDefault();
	});

	// [수정 컨트롤러 취소]-----------------------------------------------------------
	$('.cancelEdit').on('click', function(){
		$("#myAlbumPlayListDiv .del-check").prop('checked', false);
		$("header, .my-album-audio-control-section").show();
		$('#myAlbumContentSection').removeClass('deleteMode orderMode');
		$('html,body').removeClass("scrollBlock");
		//-------------
		restoreOrder();
		//-------------
	});

	// [삭제할 예문 체크박스 선택시 컨트롤러에 개수 표시]----------------------------------------
	$("#myAlbumPlayListDiv .del-check").on("change", function(){
		var selected = $("#myAlbumPlayListDiv .del-check:checked");
		$("#deleteFileController .select-count").find(".num").text(selected.length);
	});

	// [순서 변경 대상 예문을 선택, 이동]--------------------------------------------------
	var prevIndex, pad;
	$(document).on('touchstart touchmove touchend', '.orderMode .list-sentences-cover', function(e){
		switch(e.type){
		case 'touchstart':
			// 이동할 예문을 선택
			prevIndex = $(this).index();
			$(this).after('<div class="empty list-sentences-cover empty-section"></div>');
			$(this).addClass('selected');
			$('html').addClass('modalOpen');
			pad = e.touches[0].clientY - $(this).offset().top;
			break;
		case 'touchmove':
			// 예문을 손가락 따라 이동
			var y = e.touches[0].clientY;
			$(this).offset({top:y - pad});
			
			// 빈 칸 이동
			var $empty = $('.orderMode .list-sentences-cover.empty');
			if(y > $empty.offset().top + $empty.height() && $empty.next().length > 0){
				// 아래로
				$empty.next().after($empty);
			}else if(y < $empty.offset().top && $empty.prev().length > 0){
				// 위로
				$empty.prev().before($empty);
			}
			break;
		case 'touchend':
			// 예문을 이동 완료
			$('.orderMode .list-sentences-cover.empty').replaceWith($(this));
			
			// 이전과 위치가 변경됐을 경우
			if($(this).index() != prevIndex){
				var $prev = $(this).prev(), $next = $(this).next(),
					$order = $(this).find('.orderNum');
				
				$order.attr('data-org', $order.val());
				// 첫 순서로 이동
				if($(this).index() == 0){
					var nextOrder = Number($(this).next().find('.orderNum').val());
					$(this).find('.orderNum').val(nextOrder / 2);
				// 이웃 노드들 사이에 끼워져 이동
				}else if($(this).next().length > 0){
					var prevOrder = Number($(this).prev().find('.orderNum').val()),
						nextOrder = Number($(this).next().find('.orderNum').val());
					$(this).find('.orderNum').val((prevOrder + nextOrder) / 2);
				// 마지막 순서로 이동
				}else{
					var prevOrder = Number($(this).prev().find('.orderNum').val());
					$(this).find('.orderNum').val(prevOrder + 10000000);
				}
			}
			
			$(this).removeAttr('style').removeClass('selected');
			$('html').removeClass('modalOpen');
			break;
		}
	});
	
	
}); //end of ready
/* ----------------------------------------------------------------------------- 
*					editing sentence Handling page event
* --------------------------------------------------------------------------- */

/**
 * 컨트롤러 작동시 이벤트 메제지 보여주기
 */
function showControlMsg(msg) {
	var modal = $("#controlMsgModal");
	modal.find(".msg-section").html(msg);
	
	modal.fadeIn(200);
	setTimeout(function(){
		$("#controlMsgModal").fadeOut(400);
	}, 800);
}

/**
 * 문장 순서 변경 취소 및 실패로 원래대로 순서를 되돌린다.
 * @author LGM
 */
function restoreOrder(){
	// 원래 순서로 재 정렬
	var $orderNums = $('#myAlbumContentSection .orderNum[data-org]');
	for(var i=0; i<$orderNums.length; i++){
		var org = $orderNums.eq(i).attr('data-org');
		$orderNums.eq(i).val(org).removeAttr('data-org');
	}
	var sorted = $('#myAlbumContentSection .list-sentences-cover').get().sort(function(a, b) {
		return Number($(a).find('.orderNum').val())
				- Number($(b).find('.orderNum').val());
	});
	$('#myAlbumContentSection .list-sentences-cover-back').empty().append(sorted);	
	$('html,body').removeClass("scrollBlock");
}

/**
 * 플레이어와 문장 목록에서 문장들 순서에 맞게 번호를 다시 매긴다.
 * @author LGM
 */
function reorder(){
	$('#myAlbumPlayListDiv .list-sentences-cover .count').each(function(i, elem) {
		$(elem).text(i + 1);
	});
	$('#myAlbumListPlayerDiv .list-player-cover .num').each(function(i, elem) {
		$(elem).text(i + 1);
	})
	$('html,body').removeClass("scrollBlock");
}
</script>

</head>


<section layout:fragment="content" class="playvoice-tts-player-section mobile-container-mode">
<!-- -----------------------------[1. 앨범 정보]------------------------------- -->
<header id="playvoiceMobileHeader" class="playvocie-mobile-header-position">
	<!-- [1.1 자켓 이미지] -->
	<!-- <div class="mobile-index-background-section album-image-cover"
		style="background-image: url('/images/app/profile/4.jpg');"></div> -->
	
	<!-- [1.2 player header] -->
	<div th:replace="~{/tts/incl/tts_header2::player_header}"></div>
		
	<!-- [1.3 앨범 정보] -->
	<div class="mobile-index-background-section album-info-cover">
		<!-- 앨범 타이틀 -->
		<span class="album-title-cover">[[${albumTitle}]]</span>
	</div>
	<!-- 앨범 정보 수정 드롭다운 -->
	<div id="editAlbumInfoMenu" style="display: none;">
		<div class="closeAlbumInfoMenu edit-album-info-back"></div>
		<ul class="edit-album-info-cover">
			<li><i class="far fa-image fa-fw"></i> 커버 이미지 수정</li>
			<li><i class="fa fa-heading fa-fw"></i> 앨범 타이틀 수정</li>
			<li><i class="far fa-sticky-note fa-fw"></i> 앨범 설명 수정</li>
		</ul>
	</div>
</header><!-- end of albumHeaderSection -->	

<!-- ---------------------------[2. 앨범 컨텐츠 영역]----------------------------- -->	
<div id="myAlbumContentSection" class="tts-my-album-info-section">
	<!-- [2.1 메뉴] -->
	<div id="myAlbumMenuDiv" class="my-album-menu-div divide-line2 row no-gutters">
		<div class="moveAlbumDiv menu-cover col-auto" 
			data-target="Information"><i class="fa fa-compact-disc fa-fw"></i> 앨범 정보</div>
		<div class="moveAlbumDiv menu-cover col-auto active" 
			data-target="Player"><i class="fa fa-play-circle fa-fw"></i> 플레이어</div>
		<div class="moveAlbumDiv menu-cover col-auto" 
			data-target="PlayList"><i class="fa fa-bars fa-fw"></i> 플레이 리스트</div>
	</div><!-- end of myAlbumMenuDiv -->
	
	<div class="tts-my-album-player-section">
		<!-- [2.2 앨범 정보] -->
		<div id="myAlbumInformationDiv" class="my-album-content-div" 
			style="display: none;">
			<!-- 발매일 -->
			<span class="date">
				<i class="fa fa-calendar-alt"></i>
				2020-11-20
			</span>
			<!-- 수록 파일 수 -->
			<span class="file-size">
				<i class="fa fa-compact-disc"></i>
				[[${#lists.size(textList)}]]
			</span>
		</div><!-- end of myAlbumInfoDiv -->
		
		<!-- [2.3 리스트 플레이어] -->
		<div th:replace="~{/tts/list_player_incl2::player}"></div>
		
		<!-- [2.4 플레이 리스트] -->
		<div th:replace="~{/tts/list_sentences_incl2::list}"></div>
	</div>
	
</div><!-- end of myAlbumContentSection -->



<!-- ---------------------------[3. 오디오 컨트롤]------------------------------- -->
<div id="myAlbumAudioControlSection" class="my-album-audio-control-section">
	<div class="my-album-audio-control-cover row no-gutters">
		<!-- [3.1 성우] -->
		<div class="actor-section col-auto align-self-center">
			<div class="actor-image">
				<img src="/images/common/actors/Erica.jpg">
			</div>
			<div class="actor-name">Erica</div>
		</div>
		<!-- [3.2 반복 횟 수] -->
		<div class="replay-count-section col-auto align-self-center">
			<button id="setPlayCountBtn" type="button" class="btn btn-play">3</button>
			<div id="playCountOption" style="display: none;">
				<div class="closeCountOption play-count-option-back"></div>
				<div class="play-count-option-cover">
					<ul class="play-count-option">
						<li class="option" data-count="1">1</li>
						<li class="option" data-count="2">2</li>
						<li class="selected option" data-count="3">3</li>
						<li class="option" data-count="5">5</li>
						<li class="option" data-count="10">10</li>
					</ul>
				</div>
			</div>
		</div>
		<!-- [3.3 앨범 다시 재생] -->
		<div class="redo-control-section col-auto align-self-center">
			<button id="replayBtn" class="btn btn-play" type="button">
				<i class="fa fa-redo-alt"></i><span class="icon-text">all</span>
			</button>
		</div>
		<div class="col"></div>
		<!-- [3.3 재생, 일시정지] -->
		<div class="play-control-section col-auto align-self-center">
			<button class="btn btn-play" type="button">
				<i class="fa fa-play"></i>
			</button>
			<button class="btn btn-play" type="button" style="display: none;">
				<i class="fa fa-pause"></i>
			</button>
		</div>
		<div class="col-auto"></div>
	</div>
</div><!-- end of myAlbumAudioControlSection -->


<!-- ---------------------------[컨트롤 이벤트 알림창]----------------------------- -->
<div id="controlMsgModal" class="control-alert" style="display: none;">
	<div class="msg-section"></div>
</div>



</section><!-- end of content -->
</html>