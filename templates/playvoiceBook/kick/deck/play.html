<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/playvoicebook_layout}">

<head>
<title>죠니 덱 (Johnny Deck) - 플레이보이스 | Playvoice</title>

<link rel="stylesheet" th:href="@{/css/app/playkick.css}">
<link rel="stylesheet" th:href="@{/css/app/playvoicebook.css}">
<link rel="stylesheet" th:href="@{/css/app/playvoice_sponsor.css}">
<link rel="stylesheet" th:href="@{/css/app/playvoice_ad.css}">
<script th:src="@{/js/app/text.js}"></script>
<script th:src="@{/js/app/playvoicebook.js}"></script>
<script th:src="@{/js/app/playvoice_audio.js}"></script>
<script th:src="@{/js/app/playkick.js}"></script>
<script th:inline="javascript">
//물음표의 위치, 물음표의 이전 위치(수동입력시 자동완성&클릭이벤트 중복처리용) 
var blankOrder = 0, blankOrderPrev = 0;	
$(document).ready(function() {
	// [광고 설정]-----------------------------------------------------------------
	var adfit = $('.johnny-deck-ad-bottom-section ins')[0],
		destArea = $('#johnnyDeckPlayAdDiv')[0];
	//---------------------------
	migrateAdFit(adfit, destArea);
	//---------------------------
	
	// [화면 진입 시 테스트 start 영역으로 스크롤 이동]---------------------------------------
	var quizBeforeDiv = $("#quizBeforeDiv").offset().top - $('#headerNavbar').height();
	$('html, body').animate({scrollTop : quizBeforeDiv - 10}, 300);
    
	// [카드 케이스 캐릭터를 랜덤으로 세팅 (Johnny, Yaya)]-----------------------------------
	var styleIndex = Math.floor(Math.random() * 2 + 1);
	$("#quizBeforeDiv").addClass("style-" + styleIndex);
	
	if ('scrollRestoration' in history) {
	    // 브라우저의 스크롤위치 저장기능 중지
	    history.scrollRestoration = 'manual';
	}
	var $firstCard = $('#cards .swipeCard:last'); // 맨 윗장 카드 전달
	var johnnyDeck = deckJs(/*[[${testDeck}]]*/ [], 
						/*[[${discardDeck}]]*/ [], 
						/*[[${playDeckRecord}]]*/ null, 
						/*[[${deckRoundList?.get(0)}]]*/ null, 
						/*[[${T(com.varxyz.playvoice.playvoicebook.PlayvoiceBookConstants).ROUND_SIZE}]]*/ 0,
						$firstCard);
	// [퀴즈 세팅/ 시작]------------------------------------------------------------
	$(".startBtn").click(function(){
		$(window).scrollTop(0);
		// 현재 빙고판에 쌓인 덱콘을 위치에 맞게 배치
		var $deckconList = $('#deckConArea .case-divide:has(div)');
		var newList = new Array(25);
		var deckconNums = [];
		newList.fill('<div class="case-divide col-auto"></div>');
		$deckconList.each(function(i, deckcon) {
			var idx = Number($(deckcon).find('.item-divide').attr('data-idx'));
			var deckconNum = Number($(deckcon).find('.item-divide').attr('data-deckconnum'));
			$(deckcon).find('.item-divide').removeAttr('data-idx data-deckconnum');
			newList[idx] = deckcon;
			deckconNums.push([idx, deckconNum]);
		})
		$('#deckConArea').empty();
		newList.forEach(function(elt, i, array) {
			$('#deckConArea').append(elt);
		});
		// 죠니덱 초기화-------
		johnnyDeck.start(deckconNums);
		// ----------------
		
		$(this).closest(".card-dimention-section").find(".card-coverage-section").addClass("open");
		$(".test-card-back-cover").addClass("active");
		setTimeout(function() {
			$("#quizBeforeDiv").hide();
			$("#tracerQuizDiv").fadeIn(500);
			$("html").addClass("modalOpen");
		}, 300);
	});
	
	// [디스카드 수로 포커칩 세팅]-------------------------------------------------------
	var discardChips = Array.from("" + johnnyDeck.totalDiscardCount()).reverse();
	var chipColors = ['white', 'red', 'blue', 'green', 'black'];
	for(var i = 0; i < discardChips.length; i++){
		var chipSize = Number(discardChips[i]);
		if(chipSize > 0){
			var chipColor = chipColors[i];
			var $chipCover = $('<div class="deckround-list"></div>');
			var $chip = '<div class="chip-cover"><div class="pokerchip ' 
						+ chipColor + '"></div></div>';
			var $chipSizeDiv = '<div class="chip-size">'
						+ chipColor + ' 칩 ' + chipSize + '개</div>'
			$(".deckround-list-cover").prepend($chipCover);
			$chipCover.append($chipSizeDiv);
			for(var j = 0; j < chipSize; j++){
				$chipCover.append($chip);
			}
		}
	}
	
	// [테스트 가이드 열고 닫기]--------------------------------------------------------
	$("#openDeckGuideBtn, #closeDeckGuideBtn").click(function(){
		if($("#deckDescriptionDiv").is(":visible")) {
			$("#deckDescriptionDiv").hide();
		} else {
			$("#deckDescriptionDiv .description-text").show();
			$("#deckDescriptionDiv").addClass("description-open").show();
		}
	});
	
	// [Review Quiz 가이드 열고 닫기]-------------------------------------------------
	$("#openDiscardQuizGuideBtn, .closeDiscardQuizBtn").click(function(){
		$("#discardQuizGuideDiv").toggle();
	});
	
//----------------------------------------------------------------------------//
//                              카드 뒤집기 단계                                                                                //	
//----------------------------------------------------------------------------//

	// [카드 뒤집기 (예문 보기, 음성 듣기)]-----------------------------------------------
	$(document).on('click',".swipeCard:visible:not(.activeCard):last", function(){
		// 카드 앞면으로 뒤집기
		johnnyDeck.playSound('flip');
		$(this).addClass("activeCard");
		// 설명2,3 보이기
		$('#deckDescriptionDiv .description-text:eq(1)').show()
			.siblings('.description-text').hide();
	}).on('click','.activeCard', function(){
		// 카드 영어 예문 보기
		$(this).find(".eng,.sentenceVoice").fadeIn(300);
		// 설명4 보이기
		$('#deckDescriptionDiv .description-text:eq(2)').show()
			.siblings('.description-text').hide();
	})
	
	var cardX, cardY, moving = false;
	// [터치 스와이프시 카드가 손가락 위치를 따라가도록]-----------------------------------------
	var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
	$(document).on('touchstart mousedown','.swipeCard.activeCard', function(e) {
		// 멀티터치 비 허용
		if(e.touches == undefined || e.touches.length == 1){
			var elmnt = $(this)[0];
	  		var orgLeft = elmnt.offsetLeft, orgTop = elmnt.offsetTop;
		
	   		// get the mouse cursor position at startup:
	   		pos3 = (e.type == 'touchstart') ? e.touches[0].clientX : e.clientX;
	   		pos4 = (e.type == 'touchstart') ? e.touches[0].clientY : e.clientY;
	   		
	   		// call a function whenever the cursor moves:
	   		$(document).on('mousemove touchmove', elementDrag);
	   		$(document).on('mouseup touchend touchcancel', closeDragElement);
	
	 		function elementDrag(e) {
	    		e = e || window.event;
	    		// calculate the new cursor position:
	    		if(e.type == 'touchmove'){
		    		pos1 = pos3 - e.touches[0].clientX;
		    		pos2 = pos4 - e.touches[0].clientY;
		    		pos3 = e.touches[0].clientX;
		    		pos4 = e.touches[0].clientY;
	    		}else{
		    		pos1 = pos3 - e.clientX;
		    		pos2 = pos4 - e.clientY;
		    		pos3 = e.clientX;
		    		pos4 = e.clientY;
	    		}
	    		// set the element's new position:
	    		elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
	    		elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
	  		}
	
	  		function closeDragElement(e) {
	    		// stop moving when mouse button is released:
	    		$(document).off('mouseup touchend touchcancel', closeDragElement);
	    		$(document).off('mousemove touchmove', elementDrag);
	    		// 멀티 터치인 경우 카드 원 위치
	    		if(e.touches != undefined && e.touches.length > 1){
	    			$(elmnt).animate({top:orgTop,left:orgLeft}, 100);
	    		}
	    		// 오른쪽으로 넘긴 경우 (keep)
	    		else if(elmnt.offsetLeft > $(elmnt).width()/5){
	    			stopVoice();
	    			johnnyDeck.playSound('keep');
	    			$(elmnt).addClass('item-slide-right');
	    			
	    			// 카드 keep 처리-----------
	    			johnnyDeck.keep($(elmnt));
	    			//-----------------------
	    			
					$('#deckDescriptionDiv .description-text:eq(0)').show()
						.siblings('.description-text').hide();
					guideView = true;
					if(guideView) $("#deckDescriptionDiv").hide();
	    		// 왼쪽으로 넘긴 경우 (discard)
	    		}else if(elmnt.offsetLeft + $(elmnt).width()/5 < 0){
	    			stopVoice();
					$('#deckDescriptionDiv .description-text:eq(0)').show()
						.siblings('.description-text').hide();
	    			johnnyDeck.playSound('discard');
	    			$(elmnt).addClass('item-slide-left');
	    			
	    			// 카드 discard 처리-----------
	    			johnnyDeck.discard($(elmnt));
	    			//--------------------------
	
	    			discardProgress(true);
	    			// 화면 배경 색 전환
	    			$('#tracerQuizDiv').removeClass('remind').addClass('pass');
	    			
	    			$('#decisionQuizBtn').hide();
	    			addBlurClass(true);
	    			//----------------
	    			johnnyDeck.startDiscardQuiz();
	    			//----------------
	
					guideView = true;
					if(guideView) $("#deckDescriptionDiv").hide();
					
	    		// 어중간한 위치의 경우 카드 원위치
	    		}else{
	    			$(elmnt).animate({top:orgTop,left:orgLeft}, 100);
	    		}
	  		}
		}
	  		
  		
	});

	
	// [퀴즈 종료]-----------------------------------------------------------------
	$("#endQuizBtn,#completeQuizBtn").click(function(){
		if(johnnyDeck.allCardConsumed()){
			$(window).off('beforeunload');
			// 모든 카드를 넘긴 후 퀴즈 풀이 정보 submit-------------
			johnnyDeck.submitResult($('#submitResult'));
			//------------------------------------------
		}else{
			$("#playKick_modal").modal('show');
		}
	});
	// [모달창의 퀴즈 종료 클릭 이벤트]----------------------------------------------------
	$("#playKick_modal").on('click', "#endDeck_btn", function(){
		$(window).off('beforeunload');
		// 퀴즈를 강제로 종료하며 퀴즈 풀이 정보 submit-----------
		johnnyDeck.submitResult($('#submitResult'));
		//------------------------------------------
	});
	
	$(window).on('beforeunload', function(e){
		// 페이지를 벗어나기 전 퀴즈 진행 정보를 전송----
		johnnyDeck.submitInProgress(true);
		//--------------------------------
	})
	
//----------------------------------------------------------------------------//
//                              복습 테스트 단계                                                                                //
//----------------------------------------------------------------------------//
	
	// ['직접 입력하기'를 누르면 입력칸 활성화]----------------------------------------------
	$("#inputTextBtn").click(function(){
		$('#blankDiv .quizBlank div').prop('contenteditable', true);
		$("#blankDiv .target").children().focus();
		$("#blankDiv").addClass("self-input");
		$("#inputTextBtn,#wordSelectBtn").toggle();
	});
	// ['단어 선택하기'를 누르면 입력칸을 물음표로 전환]----------------------------------------
	$("#wordSelectBtn").click(function(){
		$('#blankDiv .quizBlank>div').prop('contenteditable', false);
		$("#blankDiv").removeClass("self-input");
		$("#blankDiv .blank:eq(" + blankOrder + ")").addClass('target');
		$("#inputTextBtn,#wordSelectBtn").toggle();
	});
	
	// [암기 퀴즈 단어 카드(선택지) 클릭]-------------------------------------------------
	$(document).on('mouseup', '.quizWord', function(){
		johnnyDeck.playSound('clickWord');
		if(!$(this).is('.selected')){
			$(this).data('order', Number($(this).data('order')) + 100);
			$('.quizWord:not(.selected):last').after($(this).addClass('selected'));//선택한 단어를 카드배열 가장 끝으로 이동
		}
		var selfInput = $('#blankDiv').is('.self-input');
		// 직접입력모드였을 경우 blur 이벤트로 인해 칸이 이동되므로 이전 입력 칸의 값과 비교한다.
		var inputIndex = selfInput ? blankOrderPrev : blankOrder;
		// 선택한 단어에 대한 처리 -------------------------------------
		johnnyDeck.checkAndPushToken(selfInput, inputIndex, $(this).text());
		// ----------------------------------------------------
	});
	
	// 처음 포커싱되면 단어 전체 블록지정.(수정하기 쉽게)
	$(document).on('focus', '.self-input .quizBlank [contenteditable="true"]', function(e){
		if($(this).data('editing') != null 
				|| blankOrder != $(this).parent().index()){
			return;
		}
		$(this).data('editing', true);
		if(getSelection().isCollapsed){
			var range = getSelection().getRangeAt(0);
			range.setStart(getSelection().anchorNode, 0);
			range.setEnd(getSelection().anchorNode, getSelection().anchorNode.textContent.length);
		}
	// [엔터키를 입력 시 입력 중인 카드에서 포커스를 해제]----------------------------------------
	}).on('keydown', '.self-input .quizBlank [contenteditable="true"]', function(e){
		if(e.keyCode === 13) {
			e.preventDefault();
			johnnyDeck.playSound('clickWord');
			$(this).trigger('blur');
		}
	})
	// [직접 입력 시 단어리스트에 있는 단어인지 확인]------------------------------------------
	.on('input','.self-input .quizBlank [contenteditable="true"]', function(e){
		var inputWord = $(this).text().toLowerCase();
		// 선택지 중에서 매칭되는 카드들에 활성화 표시
		$('.quizWord').each(function(i, element) {
			if(inputWord.length > 0 && $(element).text().indexOf(inputWord) == 0){
				$(element).addClass('active');
			}else{
				$(element).removeClass('active');
			}
		});
		
		// 포커스가 벗어나면 입력 중이던 내용은 대소문자를 맞춰준다.
	}).on('blur', '.self-input .quizBlank [contenteditable="true"]', function(e){
		blankOrderPrev = $(this).parent().index();
		var inputWord = $(this).text().toLowerCase();
		var foundCount = 0, foundIndex;
		if(inputWord.length > 0){
			// 선택지들을 훑어서 입력한 문자열로 시작하는 단어를 찾는다.
			$('.quizWord').each(function(i, element) {
				if($(element).text().indexOf(inputWord) == 0){
					foundCount++;
					foundIndex = i;
					return false;
				}
			});
			// 매칭되는 단어가 있으면 첫번째 매칭되는 단어를 빈칸에 채우고 다음 칸으로 이동
			if(foundCount > 0){
				var matchedWord = $('.quizWord:eq(' + foundIndex + ')').text();
				if(!$('.quizWord:eq(' + foundIndex + ')').is('.selected')){
					var $matchCard = $('.quizWord:eq(' + foundIndex + ')');
					$matchCard.data('order', Number($matchCard.data('order')) + 100);
					$('.quizWord:last').after($matchCard.addClass('selected'));// 선택한 단어를 카드 배열 맨 끝으로 이동
				}
				//-------------------------------------------------------
				johnnyDeck.checkAndPushToken(true, blankOrderPrev, matchedWord);
				//-------------------------------------------------------
			}
		}
		//-----------------
//		focusToNextBlank();
		//-----------------
		$(this).removeData('editing').parent().removeClass('target');
		$('.quizWord').removeClass('active');
	})
	
	// [답안 카드를 클릭 시 내용을 비우고 포커스를 맞춤]-----------------------------------------
	$(document).on('click', '.quizBlank', function(){
		blankOrder = $(this).index();
		$(this).siblings('.quizBlank').removeClass('target');
		$(this).addClass('target');
		
		$(this).children('div').focus();
	})
	
	// [문장 확인을 하기 위해 엔터를 치도록 툴팁 표시]------------------------------------------
	$('#decisionQuizBtn').on('focus', function(){
		if($(window).width() > 767.5) {
			$('#decisionQuizBtn .enterTooltip').show();
		}
	}).on('blur', function(){
		$('#decisionQuizBtn .enterTooltip').hide();
	}).on('click', function(){
		$(".reviewTestIconDiv").show();
		$(this).prop('disabled', true);
		// kiss and cry 뒤쪽 영역의 블러를 지움
		addBlurClass(false);
		// 단어 선택지 영역을 disable 시킴
		$("#discardQuizDiv").addClass("confirm");
		// 퀴즈 문제를 채점---------------
		johnnyDeck.checkQuizAnswer();
		//--------------------------
		blankOrder = 0;
	});
	
//----------------------------------------------------------------------------//
//						키스앤크라이(빙고) 단계									  //
//----------------------------------------------------------------------------//
	
	// [kiss & cry 영역 닫기]------------------------------------------------------
	$('#closeBreak').click(function(){
		$('#kissAndCrySection').slideUp(100);
		
		// kiss and cry 뒤쪽 영역의 블러를 지움
		addBlurClass(false);
		
		var cardsNumLeft = $('#cards .swipeCard').length;
		// 모든 문제가 끝나면 빙고판 저장 메세지 표시
		if(cardsNumLeft == 0){
			$('#saveBingoMsg').show();
			$("#endQuizBtn .button-msg1").hide();
			$("#endQuizBtn .button-msg2").show();
			$("#endQuizBtn").attr("title", "Johnny Deck 종료");
		}
	});
	// [빙고 설명 열기]--------------------------------------------------------------
	$("#explainBingo").click(function(){
		$(".bingo-explain-section").toggle();
	});
	// [빙고 설명 닫기]--------------------------------------------------------------
	$("#closeBingoDiv").click(function(){
		$(".bingo-explain-section").hide();
	});
}); // end of ready


/**
 * Kiss and Cry를 열 때 뒤쪽 영역을 블러처리함
 */
 function addBlurClass(divOpen) {
	if(divOpen) {
		$(".tracer-quiz-guide-section,.test-card-section,.discard-keep-sign-section")
		.addClass("kissAndCryBlur");
	} else {
		$(".tracer-quiz-guide-section,.test-card-section,.discard-keep-sign-section")
		.removeClass("kissAndCryBlur");
	}
}

/**
 * 카드의 discard와 keep의 progress를 표시
 */
function discardProgress(discarded) {
	var stageSize = /*[[${testDeck?.size()}]]*/ 1;
	var barWidth = 100/stageSize;
	var progressBar = "<div class=\'count-cover col-auto "
					+ ((discarded) ? "discard\'" : "keep\'")
					+ "style=\'width: " + barWidth + "%;\'><div></div></div>";
	$(".discardProgress").append(progressBar);
	$('#discardNum').text($('.discardProgress .discard').length);
	$('#keepNum').text($('.discardProgress .keep').length);
}

/**
 * 넘기지 않고 남은 카드의 수에 따라 
 * 밑장을 깔거나 카드 내용을 채운다.
 * cardsNumLeft: 남은 카드 수
 * $cardDiv: 넘긴 카드 div
 * cardContent: 한 장의 카드 정보
 */
function setCards(cardsNumLeft, $cardDiv, cardContent){
	// 카드가 4장 이상(겹쳐서 보이는 카드 최대 갯수) 남았을 경우 빈 카드를 한 장 밑에 깔아준다.
	if(cardsNumLeft > 4){
		$('#cards .swipeCard:first').before(
			$('#divsForCopy .swipeCard').clone()
				.addClass('type' + ((cardsNumLeft)%8+1))
		);
	}
	// 남은 카드(뒷장)가 있으면 카드의 내용을 채운다.
	if(cardsNumLeft > 0){
		//--------------------------------------------------------
		fillNextCard($cardDiv.prev('.swipeCard'), cardContent);
		//--------------------------------------------------------
	}	
	setTimeout(function() {
		$cardDiv.remove();
	}, 500);
}

/**
 * cardDiv의 내용을 cardContent를 참고하여 채워넣는다.
 * ※ 동적으로 채우지 않고 미리 렌더링 시 네트워크 지연시 생긴다.
 */
function fillNextCard($cardDiv, cardContent){
	// before: Level 1 stage 2, after: [""," 1 "," 2"] 
	var levelStageInfo = cardContent.stageInfo.split(/Level|stage/);
	var level = levelStageInfo[1].trim(),
		stage = levelStageInfo[2].trim();
	// 레벨, 스테이지 정보 입력
	$cardDiv.find('.level-info .levelNum').text(level);
	$cardDiv.find('.stage-info .stageNum').text(stage);
	
	// 예문 영어 입력
	var engText = emphasizeText(cardContent.eng,cardContent.emLoc,'<b></b>');
	$cardDiv.find('.eng').html(engText);
	
	// 예문 한글 입력
	$cardDiv.find('.kor').text(cardContent.kor);
	
	// 예문 보이스 호출 정보 변경
	var $voice = $cardDiv.find('.sentenceVoice');
	$voice.off('click').on('click', function(e){
			  e.stopPropagation();
			   //---------------------------------------------------
			   playVoice('/playvoiceBook/kick/deck/sentence/' + cardContent.sentenceId, "", 3, $voice[0]);
			   //---------------------------------------------------
		   });
}

/**
 * 새로운 라운드 진입으로 인한 화면 변화.
 * 라운드 번호가 바뀌고, 빙고판을 비운다.
 */
function restRound(roundNum) {
	$('#closeBreak').one('click',function(){
		$('#roundNum').text(roundNum);
		$('#deckConArea .case-divide .item-divide').remove();
		$('.lucky-point-num').text(0);
		$('#kissAndCrySection').removeClass('complete');
	});
	$('#kissAndCrySection').addClass('complete');
}

/**
 * 문장 암기 확인 퀴즈 표시
 *
 * korQuestion: 한국어 문장
 * rightTokens: 정답 토큰들
 * optionTokens: 선택지 토큰들
 */
function showDiscardQuiz(korQuestion, rightTokens, optionTokens) {
	$(".reviewTestIconDiv").hide();
	$('#decisionQuizBtn').prop('disabled', false);
	$('#discardQuizDiv .kor-text').text(korQuestion);
	$('#discardQuizDiv .blank-question-cover').empty();	 
	// 빈 칸 생성
	for(var i=0 ; i < rightTokens.length; i++){
		var blank = '<div class="quizBlank blank"><div'
				+ (' contenteditable="' + $('#blankDiv').is('.self-input') + '"')
				+ '></div></div>';
		$('#discardQuizDiv .blank-question-cover')
		.append(blank);
	}
	// 첫째칸 물음표 선정
	$('.quizBlank:first').addClass('target');
	
	// 선택지 초기화 & 생성
	$('#discardQuizDiv .answer-word-cover').empty();
   	for(var i = 0; i < optionTokens.length; i++){
	   	var word = optionTokens[i];
   		var $word = $('<div class="quizWord blank"><button>' + word + '</button></div>');
		$word.data('order',i);
   		$('#discardQuizDiv .answer-word-cover').append($word);
   	}
   	// 퀴즈 div 표시
	$('#discardQuizDiv').show();
   	// 직접 입력 모드일 경우 첫째칸에 커서 포커싱
	if($('#blankDiv').is('.self-input')){
			$('.quizBlank.target').children().focus();
	}
}

/**
 * 퀴즈의 포커싱 된 빈 칸을 채우고 다음 빈 칸으로 포커싱을 이동. 빈 칸이 다 찬 경우 확인 버튼 표시
 */
function fillBlankAndNext(selfInput, inputIndex, token) {
	// 선택지들 중에 선택된 것과 안 된 것을 다시 분류--------------------------------
	var entitled = [];
	entitled.push(token.toLowerCase());
	$('.quizBlank>div').each(function(i, element) {
		if(i != inputIndex && element.textContent!= null && element.textContent.length > 0){
			var title = element.textContent.toLowerCase();
			if(entitled.indexOf(title) == -1){
				entitled.push(title);
			}
		}
	});
	var words = $('.quizWord').each(function(i, element) {
		var optionWord = element.textContent.toLowerCase();
		if($(element).is('.selected') && entitled.indexOf(optionWord) == -1){
			$(element).data('order', Number($(element).data('order')) - 100 );
			$('.quizWord:not(.selected):last').after($(element).removeClass('selected'));
		}
	}).get().sort(function(a, b) {
		return Number($(a).data('order')) - Number($(b).data('order'));
	})
	
	for(var i = 0; i < words.length; i++){
		words[i].parentNode.appendChild(words[i]);
	}
	//------------------------------------------------------------
	
	
	if(selfInput){
		$('.quizBlank:eq(' + inputIndex + ')>div').text(token);
		// 직접입력모드일 때 입력값없이 선택지를 골랐을 경우,
		// 포커스가 원위치 되므로 이동시킨다.
		if(blankOrder == blankOrderPrev){
			focusToNextBlank();
		}
	}else{
		// 물음표 표시된 칸의 물음표를 지우고 선택지 단어를 채움
		$('.quizBlank:eq(' + inputIndex + ')').removeClass('target')
											  .html('<div>' + token + '</div>');		
		//-----------------
		focusToNextBlank();
		//-----------------
	}
}
/**
 * 다음 빈 칸으로 포커싱을 이동. 빈 칸이 다 찬 경우 확인 버튼 표시
 */
function focusToNextBlank(){
	blankOrder++;
	// 모든 빈칸이 다 채워짐 -> 확인하기
	if($('.quizBlank>div:empty').length == 0 
	&&blankOrder > $('.quizBlank:last').index()){
		$('#decisionQuizBtn').show().focus();
	}else{
		var $target = $('.quizBlank:eq(' + blankOrder +')').addClass('target');
		if($('#blankDiv').is('.self-input')){
			$target.children().focus();
		}
	}		
}

/**
 * 덱콘 획득 성공 화면 효과
 * deckcon: 획득한 덱콘
 * color: 덱콘의 클래스에 따른 배경색
 * bingoCells: 빙고 완성된 줄에 놓인 덱콘들
 */
function getDeckconSuccess(deckcon, color, bingoCells) {
	var $deckcon = $('<div class="fa-spin item-divide" style="position:absolute;'
			+ 'left: calc(50% - 175px);width:350px; z-index: 6;">'
			+ '<img src="/images/app/playvoicebook/deckcon/con_' 
			+ deckcon.iconNum + '.svg" style="max-width: 85%;"></div>');
	var $luckyPoint = $('<div class="lucky-point-coin big'
					+ ' class' + (Math.floor(deckcon.iconNum/20)+1) 
					+ ((deckcon.iconNum < 0) ? ' lose':'')
					+ '" style="position:absolute;'
					+ 'left: calc(50% - 225px); z-index: 6;">'
					+ '<div class="point-num">'+ 
					+ deckcon.luckyPoint + '</div>'
					+ '<div class="crack"></div></div>');
	$('.lucky-point-num').text(deckcon.luckyPoint + Number($('.lucky-point-num').text()));
	$('#kissAndCrySection').prepend($deckcon);
	$deckcon.after($luckyPoint);
	$luckyPoint.animate({top:'200px'},500, function(){
		setTimeout(function() {
			$luckyPoint.addClass('fa-spin');
			$luckyPoint.animate({
				top: $('.gift-top').offset().top + $luckyPoint.height()/2 - $('.gift-top').height()/2,
				left: $('.gift-top').offset().left + $luckyPoint.width()/2 - $('.gift-top').width()/2,
				height: 0,
				width: 0
			}, 600, function(){
				$luckyPoint.remove();
			})
		}, 1000);
	});
	// 화면 중앙으로 덱콘이 회전하며 이동
	$deckcon.animate({top:'200px'}, 500, function(){
			setTimeout(function() {
				// 덱콘의 회전을 멈추고 빙고판 속으로 이동
				$deckcon.removeClass('fa-spin').addClass('basket_shoot');
				setTimeout(function() {
					$deckcon.removeClass('basket_shoot')
						 .attr('style','background-color:' + color)
						 .appendTo($('#deckConArea .case-divide:eq(' + deckcon.index + ')'));
					//---------------------------
					effectBingoLines(bingoCells);
					//---------------------------
				}, 600);
			}, 1500);
		}
	)
	$('#discardQuizDiv').fadeOut(100);
	$('#kissAndCrySection').fadeIn(100);
	addBlurClass(true);
}

/**
 * 빙고가 완성된 줄에 놓인 덱콘들에 강조 효과(회전) 적용
 */
function effectBingoLines(bingoCells) {
	bingoCells.forEach(function(elt, i, array) {
		$('#deckConArea .case-divide:eq('+elt+') .item-divide').addClass('rotating');
	});	
}

/**
 * 덱콘 획득 실패 화면 효과
 * deckconNum에 해당하는 덱콘 획득에 실패하는 화면 효과
 */
function dropDeckcon(deckconNum){
	discardProgress(false);
	// 화면 배경 색 전환
	$('#tracerQuizDiv').removeClass('pass').addClass('remind');
	$('#kissAndCrySection').fadeIn(100);
	addBlurClass(true);
	// deckconNum에 해당하는 덱콘 생성
	var $deckcon = $('<div class="fa-spin item-divide" style="position:absolute;'
			+ 'left: calc(50% - 175px);width:350px; z-index: 6;">'
			+ '<img src="/images/app/playvoicebook/deckcon/con_' 
			+ deckconNum + '.svg" style="max-width: 85%;"></div>');
	$('#kissAndCrySection').prepend($deckcon);
	// 화면 중앙으로 덱콘이 회전하며 이동
	$deckcon.animate(
		{top:'200px'
		}, 500, function(){
			setTimeout(function() {
				// 덱콘의 회전을 멈추고 아래로 떨어뜨려서 삭제
				$deckcon.removeClass('fa-spin')
					 .animate({
						top:'600px' 
					 }, 800, function(){
							$deckcon.remove();
					 });
			}, 500);
		}
	)	
}

/**
 * 예문 난이도 표시
 */
function sentenceLevelRate(total, wrong) {
	var mod = total > 0 ? total : 1;
	// 최소 5%, 최대 95%까지 표시
	var quotient = Math.min(0.95, Math.max(0.05, wrong / mod));
	var rateDeg = 180 * quotient - 45;
	var ratePersent = Math.ceil(20 * quotient) * 5;
	var rateText;
	if(ratePersent <= 10) {
		rateText = 'super easy';
	} else if (ratePersent <= 30) {
		rateText = 'easy';
	} else if (ratePersent <= 50) {
		rateText = 'normal';
	} else if (ratePersent <= 80) {
		rateText = 'hard';
	} else {
		rateText = 'very hard';
	}
	$("#sentenceLevel .difficulty-rate").css("transform", "rotate(" + rateDeg + "deg)");
	$("#sentenceLevel .rate-text-cover").text(rateText);
	$("#sentenceLevel .rate-count-cover").text(ratePersent);
}

/**
 * 자동으로 닫히는 확인창 열기 (리뷰테스트를 맞추거나 틀렸을 경우 결과를 메세지로 보여줌)
 */
 function openConfirmDiv(msg, success, eng) {
 	$("#playKick_confirmMsg .msgSection").html(msg);
	$("#playKick_confirmMsg").removeClass("good bad").show();
	if(success) {
		$("#playKick_confirmMsg").addClass("good");
		$('#viewBingoBtn').hide();
	} else {
		$('#decisionQuizBtn').hide();
		$('#viewBingoBtn').show();
		$('#discardQuizDiv .eng-text').text(eng).show();
		$("#playKick_confirmMsg").addClass("bad");
	}
	
	setTimeout(function() {
		$("#playKick_confirmMsg").fadeOut(200);
	}, 1200);
}
 
</script>
</head>

<section layout:fragment="content">
<!-- title & menu -->
<div id="menuSection" th:insert="~{/playvoiceBook/incl/playvoicebook_menu::menu}"></div>


<!--/* -------------------------------[Modal] -----------------------------*/-->
<div id="playKick_modal" class="play-kick-modal modal fade" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content content-container">
			<div class="modal-body text-center">
				<div class="row no-gutters">
					<div class="col-sm text-center">
						<img src="/images/common/characters/africa_sad.png" width="100px">
					</div>
					<div class="col-sm-auto px-2 align-self-center">
						테스트가 아직 끝나지 않았습니다.<br>종료하겠습니까?
					</div>
					<div class="col-sm"></div>
				</div>
			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-outline-info btn-sm" 
					data-dismiss="modal">계속하기</button>
				<button id="endDeck_btn" type="button" class="btn btn-info btn-sm" 
					data-dismiss="modal">종료하기</button>
			</div>
		</div>
	</div>
</div>

<!--/* ----------------------------[확인 메세지 창] ----------------------------*/-->
<div id="playKick_confirmMsg" class="play-kick-confirm-msg" style="display: none;">
	<div class="msg-modal-header">
		<div class="header-image">
			<div class="face">
				<div class="eye"></div><div class="eye right"></div>
				<div class="mouth"></div>
			</div>
		</div>
		<div class="header-text"></div>
	</div>
	<div class="play-kick-confirm-msg-cover">
		<div class="msgSection"></div>
	</div>
</div>

<th:block th:if="${sufficientPoint == true}" th:with="newStageOpen
	= ${session.userContainer?.sessionStorage?.get('newStageOpen')}">
<div id="cardQuizSection" th:if="${newStageOpen == false}" 
	class="playvoice-play-kick-section my-4">
	
<!-- -----------------------[1. 테스트 시작 전]---------------------------------- -->	
<div id="quizBeforeDiv" class="before-quiz-section">
	<!-- ------------------------[1.1 라운드 수]-------------------------------- -->
	<div class="round-section">
		<label class="round-cover">
			<span class="poker-icon">&#9827;</span> 
			<span class="num" th:text="${deckRoundList?.get(0)?.roundNum}"></span> Round
			<span class="poker-icon ml-3">
				<img src="/images/app/playvoicebook/poker_chip.png" alt="플레이보이스"
					title="카드를 discard하면 Johnny Deck 칩을 딸 수 있습니다">
			</span>
			<span th:text="${playDeckRecord?.discardCount}" class="num"></span>
		</label>
	</div>
	<!-- ---------------------[1.2 시작 버튼/ 카드 상자]--------------------------- -->
	<div class="card-dimention-section">
		<div class="startBtn card-coverage-section">
			<div class="test-card-coverage cube-side top">
				<img src="/images/app/playvoicebook/card_case_paper.png">
				<div class="case-deco-line">
					&#9670; <span class="text-dark">&#9827;</span>
					&#9829; <span class="text-dark">&#9824;</span>
					&#9670; <span class="text-dark">&#9827;</span>
					&#9829; <span class="text-dark">&#9824;</span><br>
					<span class="deco-text">Johnny's Deck</span>
				</div>
			</div>
			<div class="cube-side bottom"></div>
			<div class="cube-side left"></div>
			<div class="cube-side right">Johnny's Deck</div>
			<div class="cube-side front"><div>speak out!</div></div>
			<div class="cube-side back"></div>
			<div class="card-click-text">click</div>
		</div>
	</div>
	<div class="guide-arrow left fadeout-blink">
		<div><i class="fa fa-arrow-left"></i></div>
		<div class="mt-2">Discard</div>
	</div>
	<div class="guide-arrow right fadeout-blink">
		<div><i class="fa fa-arrow-right"></i></div>
		<div class="mt-2">Keep</div>
	</div>
	
	<!-- --------------------[1.3 discard 포커 칩]---------------------------- -->
	<div class="deckround-list-section"><div class="deckround-list-cover">
	</div></div>
	
</div><!-- end of quizBeforeDiv -->


<!-- -------------------------[2. 테스트 영역]---------------------------------- -->
<div id="tracerQuizDiv" class="play-kick-section" style="display: none;">
	<!-- -----------------------[2.1 가이드, 종료 버튼]--------------------------- -->
	<div class="tracer-quiz-guide-section container"><div class="row no-gutters">
		<div class="quiz-guide-div col-auto text-left align-self-center">
			<i id="openDeckGuideBtn" class="guide-button fa fa-question-circle" title="죠니덱 테스트 방법"></i>
		</div>
		<div class="col align-self-center">
			<!-- [discard & keep progress] -->
			<div class="discard-keep-sign-section">
				<div class="loading-line-section"><div class="discardProgress row no-gutters">
				</div></div>
			</div>
		</div>
		<div class="quiz-guide-div text-right col-auto align-self-center">
			<button id="endQuizBtn" class="btn btn-main2 end-quiz-btn" title="그만하기">
				<i class="fa fa-power-off"></i> 
				<span class="d-none d-md-inline-block">
					<span class="button-msg1">Quit</span>
					<span class="button-msg2" style="display: none;">End</span>
				</span>
			</button>
		</div>
	</div></div>
	<!-- -----------------------[2.2 플레이 설명 영역]---------------------------- -->
	<div id="deckDescriptionDiv" class="johnny-deck-description">
		<div class="description-text">
			<span class="num">1.</span> 카드를 <b>클릭</b>해서 뒤집어 주세요.
		</div>
		<div class="description-text" style="display: none;">
			<span class="num">2.</span> 우리말 문장을 보고 <b>영어</b>로 말해 보세요.<br>
			<span class="num">3.</span> 정답을 보려면 카드를 한 번 더 클릭해 주세요.
		</div>
		<div class="description-text" style="display: none;">
			<span class="num">4.</span> 자신 있게 말할 수 있는 카드는
			<b>왼쪽(discard)</b>으로,<br class="d-none d-sm-block">
			어려운 것은 <b>오른쪽(keep)</b>으로 슬라이드 해 주세요.
		</div>
		<i id="closeDeckGuideBtn" class="fa fa-times"></i>
	</div>
	
	<div id="saveBingoMsg" class="quiz-last-guide-section" style="display: none;">
		<div class="playvoice-check-icon">
			<span class="icon-line line-tip"></span>
			<span class="icon-line line-long"></span>
			<div class="icon-fix"></div>
		</div>
		<div class="quiz-last-guide-text">빙고판이 저장되었습니다 <i class="far fa-grin-alt"></i></div>
	</div>
	
	<!-- -------------------------[2.3 테스트 영역]----------------------------- -->
	<div class="test-card-section">
		<div class="test-card-div">
			<!-- last card -->
			<div id="completeQuizBtn" class="last-card"><div class="card-text-section">
				<div class="test-card card-back">
					<div class="card-paper-position"></div>
					<div class="card-text">
						<div class="discard-count">
							<div>말할 수 있는<br>문장</div>
							<div id="discardNum" class="num mt-1"></div>
						</div>
						<div class="keep-count">
							<div id="keepNum" class="num mb-1"></div>
							<div>추가 학습이<br>필요한 문장</div>
						</div>
					</div>
					<div class="card-center-line"></div>
				</div>
			</div></div>
			<!-- test card -->
			<div id="cards" class="stack--dian" 
				th:with="cardLength = ${T(Math).min(testDeck?.size()?:0, 5)}">
				<div th:each="i:${#numbers.sequence(cardLength,1,-1)}"
					class="swipeCard test-card-cover" th:classappend="'type'+${i}">
					<div class="card-text-section">
						<!-- 카드 뒷면 -->
						<div class="test-card card-back">
							<div class="card-paper-position"></div>
							<div class="card-text"><div class="card-sentence">
								<!-- 한글 해석 -->
								<div class="kor">내가 이거 봐줄까? / 이거 내가 살펴봐 줄까?</div>
								<!-- 영어 예문 -->
								<div class="eng" style="display: none;">
									<b>Do you want me to</b> go through this?
								</div>
								<a class="sentenceVoice" style="display: none;">
									<i class="fa fa-headphones-alt"></i>
								</a>
							</div></div>
							<div class="level-info">
								L<span class="levelNum">3</span><br>
								<label class="card-icon"></label>						
							</div>
							<div class=stage-info>
								<label class="card-icon"></label><br>
								S<span class="stageNum">12</span>
							</div>
						</div>
						<!-- 카드 앞면 -->
						<div class="test-card card-front">
							<div class="card-paper-position"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	
	<!-- -------------------------[2.4 죠니덱 광고]----------------------------- -->
	<div id="johnnyDeckPlayAdDiv" class="johnny-deck-ad-section"></div>
	
	
	<!-- -------------------------[2.5 리뷰 테스트 영역]-------------------------- -->
	<div id="discardQuizDiv" class="discard-word-quiz-section" style="display: none;">
		<div class="discard-word-quiz-guide">
			<h1>Review Test</h1>
			<div class="sub-title">리뷰 테스트는 DISCARD한 카드들을 복습합니다.</div>
		</div>
		<i id="openDiscardQuizGuideBtn" class="open-guide-btn far fa-question-circle"></i>
		<!-- 퀴즈 영역 -->
		<div class="discard-quiz-kor">
			<!-- 한국어 -->
			<div class="kor-section">
				<i class="fa fa-quote-left"></i>
				<span class="kor-text">나는 엄마에게 용돈을 주었다.</span>
				<i class="fa fa-quote-right"></i>
			</div>
			<!-- 정답 (틀린 경우) -->
			<span class="eng-text" style="display: none;">
				I gave my mom some money.
			</span>
			<!-- 단어 빈칸 -->
			<div id="blankDiv" class="blank-question-cover">
				<div class="blank"><div></div></div>
			</div>
			<!-- 난이도 -->
			<div id="sentenceLevel" class="difficulty-rating-section style3">
				<div class="difficulty-rate-cover">
					<div class="rate-boundary super-hard"></div>
					<div class="rate-boundary hard"></div>
					<div class="rate-boundary difficult"></div>
					<div class="rate-boundary normal"></div>
					<div class="difficulty-rate" style="transform: rotate(-45deg);"></div>
				</div>
				<div class="rate-text-section">
					<div class="rate-count-cover"></div>
					<div class="rate-text-cover"></div>
				</div>
			</div>
		</div>
		<!-- 단어 선택지 영역 -->
		<div class="discard-quiz-word-cover">
			<div class="confirm-button-section">
				<button id="decisionQuizBtn" class="btn btn-confirm" type="button"
					style="display: none;position: relative;">
					<i class="far fa-check-circle"></i> 확인
					<div class="enterTooltip text-warning-msg" style="display: none;">
						엔터키를 누르세요
					</div>
				</button>
				<button id="viewBingoBtn" class="btn btn-confirm btn-bingo" 
					type="button" style="display: none;"> Go Bingo!</button>
				<div class="reviewTestIconDiv test-result-icon-section" style="display: none;">
					<img src="/images/common/icon/volume_icon.gif">
				</div>
			</div>
			<div class="input-type-section d-none d-md-block">
				<button id="inputTextBtn" type="button">
					<i class="far fa-keyboard"></i> 직접 입력하기
				</button>
				<button id="wordSelectBtn" type="button" style="display: none;">
					<i class="fa fa-th-large"></i> 단어 선택하기
				</button>
				<div class="sort-desc">
					<i class="sort-icon fa fa-sort-alpha-down"></i>
					알파벳 순 정렬
				</div>
			</div>
			<div class="answer-word-cover">
				<div class="blank"><button></button></div>
			</div>
		</div>
		
		<!-- 리뷰 테스트 가이드 -->
		<div id="discardQuizGuideDiv" class="discard-quiz-guide-section" style="display: none;">
			<ol>
				<li>우리말 예문을 보고 <label class="blank target">?</label> 에 
				들어갈 단어를 아래의 단어 목록에서 선택하여 영어 문장을 완성해 주세요.</li>
				<li><label class="input-button-style"><i class="far fa-keyboard"></i> 직접 입력하기</label>
				선택 시, 빈칸에 단어를 직접 입력할 수 있습니다.</li>
				<li>직접 입력 모드에서 단어를 입력 시, 입력한 알파벳에 해당하는 단어가 아래의 단어 목록에서 활성화됩니다.</li>
				<li>아래의 단어가 활성화된 상태에서 <kbd>Enter</kbd> 또는 <kbd>Tab</kbd>을 누르면 활성화된 단어 중 
				첫 번째가 빈칸에 채워집니다.</li>
			</ol>
			<div class="mt-3">
				※ Safari 브라우저에선 문장을 모두 완성한 후 <kbd>Tab</kbd>을 누르면 주소줄이 활성화되므로
				<kbd>Enter</kbd>를 눌러주세요.<br>
			</div>
			<div class="mt-2">
				※ 리뷰 테스트는 디스카드한 예문들을 재인출하기 위한 퀴즈이므로 등장한 예문이 다시 나올 수 있습니다.
			</div>
			<i class="closeDiscardQuizBtn fa fa-times"></i>
		</div>
	</div>
	
	<!-- ------------------------[2.6 kiss & cry 영역]----------------------- -->
	<div id="kissAndCrySection" class="kiss-and-cry-section background1" style="display: none;">
		<!-- 폭죽 -->
		<div class="firework-effect">
			<div class="firework-start"></div>
			<div class="firework-during"></div>
		</div>
		<!-- 라운드 -->
		<div class="round-title-section">
			<div class="round-section">
				<label class="round-cover">
					<span class="poker-icon">&#9827;</span>
					<span class="complete-msg">Bingo is complete! <i class="far fa-grin-alt"></i></span> 
					<span id="roundNum" class="num" 
					th:text="${deckRoundList?.get(0)?.roundNum}"></span> Round
				</label>
			</div>
		</div>
		<!-- title -->
		<div class="kiss-and-cry-title">
			bonus <b>bingo</b> time <i class="fa fa-th"></i>
		</div>
		<!-- 빙고 설명 영역 -->
		<div class="kiss-and-cry-desc-section">
			<i id="explainBingo" class="far fa-question-circle" title="빙고 설명 보기"></i>
		</div>
		<div class="bingo-explain-section">
			<div class="explain-text-section">
				<h5>bonus bingo</h5>
				<i id="closeBingoDiv" class="fa fa-times"></i>
				<div class="explain-text">
					카드를 <b>discard</b>하면 덱콘이 지급됩니다!<br>
					같은 세트 덱콘의 빙고 개수에 따라 상품을 드려요!<br>
					상품은 다음 달 1일 (휴무 제외) 등록된 번호 또는 주소지로 일괄 지급 됩니다.<br>
					<span class="d-lg-none"><br><br>
						※ 럭키 포인트는 빙고 한 라운드가 완성되면<br>플레이 포인트로 지급됩니다.
					</span>
				</div>
			</div>
			<div class="bingo-item-cover">
				<div class="bingo-gift-item-area">
					<div class="empty-area"></div>
					<div class="item-area style1"><img src="/images/app/playvoicebook/deckcon/con_0.svg"></div>
					<div class="item-area style2"><img src="/images/app/playvoicebook/deckcon/con_20.svg"></div>
					<div class="item-area style3"><img src="/images/app/playvoicebook/deckcon/con_40.svg"></div>
					<div class="item-area style4"><img src="/images/app/playvoicebook/deckcon/con_60.svg"></div>
					<div class="item-area style5"><img src="/images/app/playvoicebook/deckcon/con_80.svg"></div>
					<div class="empty-area">Bingo1</div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="empty-area">Bingo2</div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="empty-area">Bingo3</div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="empty-area">Bingo4</div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="empty-area">Bingo5</div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
					<div class="item-area"></div><div class="item-area"></div>
				</div>
				<img src="/images/app/playvoicebook/deckcon/bingo_items.png">
			</div>
		</div>
		
		<!-- 럭키 포인트 영역 -->
		<div class="lucky-point-section">
			<div class="explain-text-section">
				<h5>Lucky Point</h5>
				<div class="explain-text">
					획득한 럭키 포인트는 빙고 한 라운드가 모두 끝나면<br>
					<b>플레이 포인트(골드 포인트)</b>로 지급됩니다
				</div>
			</div>
			<div class="gift-box-section">
				<div class="gift" title="럭키 포인트 상자">
					<div class="gift-top"></div>
					<div class="gift-box">
						<div class="lucky-point-num">[[${session.userContainer?.sessionStorage?.get('bingoView')?.luckyPoint}]]</div>				
						<div class="play-point-mark"></div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- 덱콘 빙고 영역 -->
		<div class="deck-con-section roundCase1">
			<div class="deck-con-case">
				<div class="deck-con-case case-side front">
					<!-- 덱콘 영역 -->
					<div id="deckConArea" class="case-divide-low row no-gutters"
						th:with="deckconList = ${session.userContainer?.sessionStorage?.get('bingoView')?.deckconList},
						backgroundList = ${ {'#ff6060','#ffdc46','#66ff59','#5f85ff','#d53eff'} }">
						<div th:each="cellNum:${#numbers.sequence(0,24,1)}" 
							class="case-divide col-auto">
							<div th:if="${deckconList[cellNum] != null AND
									deckconList[cellNum]?.iconNum GT -1}"
								th:with="deckcon = ${deckconList[cellNum]}"
								th:data-idx="${deckcon?.index}"
								th:data-deckconnum="${deckcon.iconNum}"
								th:style="'background-color:'+ ${backgroundList[deckcon.iconNum/20]}"
								class="item-divide">
								<img th:src="'/images/app/playvoicebook/deckcon/con_'+${deckcon.iconNum} +'.svg'"/>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="closeBreak" class="close-section-div">
			<div class="close-text infi-blink">click to continue</div>
		</div>
	</div>
	
	
</div><!-- end of tracerQuizDiv -->
</div><!-- end of cardQuizSection -->


<!-- -----------------------[Johnny Deck 플레이 할 수 없음 ]----------------------- -->
<div id="cardQuizSection" th:unless="${newStageOpen == false}" 
	class="playvoice-play-kick-section my-4">
	<div id="quizBeforeDiv" class="before-quiz-section empty-quiz">
		<div class="card-dimention-section">
			<div class="card-coverage-section">
				<div class="test-card-coverage cube-side top">
					<img src="/images/app/playvoicebook/card_case_paper.png">
					<div class="case-deco-line">
						&#9670; <span class="text-dark">&#9827;</span>
						&#9829; <span class="text-dark">&#9824;</span>
						&#9670; <span class="text-dark">&#9827;</span>
						&#9829; <span class="text-dark">&#9824;</span><br>
						<span class="deco-text">Johnny's Deck</span>
					</div>
				</div>
				<div class="cube-side bottom"></div>
				<div class="cube-side left"></div>
				<div class="cube-side right">Johnny's Deck</div>
				<div class="cube-side front"><div>speak out!</div></div>
				<div class="cube-side back"></div>
				<div class="card-click-text empty-card">
					<a th:href="@{/playvoiceBook/level}">There is not enough<br>cards in your deck.</a>
				</div>
			</div>
		</div>
		
		<!-- --------------[카드를 모두 discard하여 테스트 할 문제가 없는 경우]------------- -->
		<div class="play-kick-guide-message">
			<div class="play-kick-guide-cover d-flex align-content-between flex-wrap">
				<div class="play-kick-guide-title">
					<label class="title-border">
						<span class="johnny-deck">
							<span class="card-icon">&#9670;</span>
							Johnny  Deck
							<span class="card-icon">&#9824;</span>
						</span>
						축하합니다!<br> 신규 Stage가 오픈되었습니다.<br>
						<a class="study" th:href="@{/playvoiceBook/level}">
							<i class="fa fa-book-open"></i> 학습하기
						</a>
						 에서 새로운 Stage를 먼저 학습해 주세요.
					</label>
				</div>
				<div class="play-kick-guide">
					<button th:href="@{/playvoiceBook/level}" type="button"
						onclick="location.href=$(this).attr('href')" 
						class="btn btn-mobile btn-goto-study">
						<i class="fa fa-book-open"></i> 학습하기
					</button>
				</div>
				<div class="precautions">
					<ul>
						<li>한 번 <b class="point">Discard한 문장</b>은 출제되지 않습니다.</li>
						<li>죠니 덱에서 남은 카드의 수가 15개 이하가 되었을 때 플레이보이스북의 다음 스테이지가 열립니다.</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>


<div id="divsForCopy" style="display: none;">
<div class="swipeCard test-card-cover">
	<div class="card-text-section">
		<!-- 카드 뒷면 -->
		<div class="test-card card-back">
			<div class="card-paper-position"></div>
			<div class="card-text"><div class="card-sentence">
				<!-- 한글 해석 -->
				<div class="kor"></div>
				<!-- 영어 예문 -->
				<div class="eng" style="display: none;"></div>
				<a class="sentenceVoice" style="display: none;">
					<i class="fa fa-headphones-alt"></i>
				</a>
			</div></div>
			<div class="level-info">
				L<span class="levelNum"></span><br>
				<label class="card-icon"></label>						
			</div>
			<div class="stage-info">
				<label class="card-icon"></label><br>
				S<span class="stageNum"></span>
			</div>
		</div>
		<!-- 카드 앞면 -->
		<div class="test-card card-front">
			<div class="card-paper-position"></div>
		</div>

	</div>
</div>
<form id="submitResult" th:action="@{/playvoiceBook/kick/deck/end}" method="post"></form>
</div>
</th:block>



<!-- ----------------------------[포인트 부족]--------------------------------- -->
<th:block th:unless="${sufficientPoint == true}">
<div id="cardQuizSection" class="playvoice-play-kick-section my-4">
	<div id="quizBeforeDiv" class="before-quiz-section">
		<div class="card-dimention-section">
			<div class="card-coverage-section">
				<div class="test-card-coverage cube-side top">
					<img src="/images/app/playvoicebook/card_case_paper.png">
					<div class="case-deco-line">
						&#9670; <span class="text-dark">&#9827;</span>
						&#9829; <span class="text-dark">&#9824;</span>
						&#9670; <span class="text-dark">&#9827;</span>
						&#9829; <span class="text-dark">&#9824;</span><br>
						<span class="deco-text">Johnny's Deck</span>
					</div>
				</div>
				<div class="cube-side bottom"></div>
				<div class="cube-side left"></div>
				<div class="cube-side right">Johnny's Deck</div>
				<div class="cube-side front"><div>speak out!</div></div>
				<div class="cube-side back"></div>
				<div class="card-click-text empty-card">
					Community activity required
				</div>
			</div>
		</div>
		<div class="play-kick-guide-message">
			<div class="play-kick-guide-cover">
				<div class="play-kick-guide-title">
					<label class="title-border">
						<span class="johnny-deck">
							<span class="card-icon">&#9827;</span>
							Johnny  Deck
							<span class="card-icon">&#9824;</span>
						</span>
						카드 셔플을 위한 플레이 포인트가 부족합니다.
					</label>
				</div>
				<div class="play-kick-guide">
				
				</div>
			</div>
		</div>
	</div>
</div>
</th:block>

<!-- 죠니덱 광고 -->
<div class="johnny-deck-ad-bottom-section">
	<ins class="kakao_ad_area" style="display:none;" 
		data-ad-unit    = "DAN-Or9qVI6QoPXV98j3" 
		data-ad-width   = "320" 
		data-ad-height  = "50"></ins> 
	<script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
</div>



</section>
</html>